<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Page Properties -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1,
    shrink-to-fit=no"
    />

    <!-- Site Title and Description -->
    <title>WebSocket Service</title>

    <!-- Scripts -->
    </article> 
    <script type="application/javascript" async defer>
    (function() {
      let ws;
      /**
       * Appends a string in a paragraph to the target element.
       *
       * Call this with 'bellboy-text' or 'website-text' to add 'log data'
       * to either the bellboy or website columns.
       */
       var connected = document.getElementById("connected");
       var state = document.getElementById("status");
       var bb = document.getElementById(elementId);
       var msg = document.createElement("msg");
       
       const readline = require("readline");
       const rl = readline.createInterface({
        input: process.stdin,
        output: process.stdout
       });

      
      //get "message" from command line input 
       function onMessage(event) {

        r1.message("send message :", function(event) {
          var message = event.data;
          console.log(`sent: ` + message);
          connected.innerHTML=message;
       })
      }
      r1.close();
     
      //add String to container
      function addText(string, elementId) {
        msg.innerText = string;
        bb.appendChild(msg);
        msg.scrollIntoView();
      }

      //closes connection
    function onClose(event) {
      state.className = "fail";
      state.innerHTML = "Not connected";
      connected.innerHTML = "0";
    }
    // set up bellboy connection
      function setupBellboy() {
        // Creates a websocket connection as the bellboy.
        let bellboy = new WebSocket("ws://localhost:3000/WebSocket");
        bellboy.onopen = function () {
          console.log('connection openned')
          state.className = "success";
          connected.innerHTML = "1";
          bellboy.send("Hello BellBoy");
          
          setInterval(function() {
            if (connected.readyState == "0") {
               onClose();
               state.innerHTML = "Unable to communicate with BellBoy server.";
               state.className = "Fail";
            }
          }, 
          3000);
        };
      }
      // set up website connection
      function setupWebsite() {
        // Creates a websocket connection as the website.
        let website = new WebSocket("ws://localhost:3000/Website");
        bellboy.onopen = function () {
          state.className = "success";
          state.innerHTML = "Connected to server";
          connected.innerHTML = "1";
          website.send("Hello Website");

          setInterval(function() {
            if (connected.readyState == "0") {
               onClose();
               state.innerHTML = "Unable to communicate with BellBoy server.";
               state.className = "Fail";
            }
          }, 
          3000);
        };
      }
        
     
      /*
       * On load operation. Calls a number of functions once the DOM is ready.
       * ALL features should be called in this block.
       */
      window.addEventListener("load", function (event) {

        // Feature functions:
        setupBellboy();
        setupWebsite();
        onMessage(load);

        addText(msg,"bellboy-text");
        addText(msg,"website-text");
       
       

      });
      rl.on("close", function() {
        process.exit(0);
    
      });

    })()
    </script>

    <style>
      html,
      body {
        background: #aaa;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        height: 98%;
        overflow: hidden;
        text-align: left;
      }
      .container {
        display: flex;
        height: 98%;
      }
      .child {
        background: white;
        flex: 1;
        border: 2px solid black;
        padding: 5px;
        margin: 5px;
        height: 98%;
        display: block;
        border-radius: 8px;
      }
      .scroll-container {
        height: 80%;
        border: 1px solid #ddd;
        overflow-y: scroll;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="child">
        <h1>Bellboy</h1>
        <p>Log messages:</p>
        <div class="scroll-container">
          <div id="bellboy-text" class="scroll"></div>
        </div>
      </div>
      <div class="child">
        <h1>Website</h1>
        <p>Log messages:</p>
        <div class="scroll-container">
          <div id="website-text" class="scroll"></div>
        </div>
      </div>
    </div>
  </body>
</html>
